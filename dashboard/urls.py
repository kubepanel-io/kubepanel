from django.urls import path, re_path
import re
from .views import (
    UserProfilePackageUpdateView, PackageListView, PackageCreateView, PackageUpdateView,
    UserProfileListView, UserProfileCreateView, UserProfileUpdateView,
    UserCreateView, DownloadSnapshotView, DownloadSqlDumpView, UploadRestoreFilesView
)
from dashboard.k8s import (
    DomainSpec,
    create_domain as k8s_create_domain,
    delete_domain as k8s_delete_domain,
    get_domain as k8s_get_domain,
    list_domains as k8s_list_domains,
    suspend_domain as k8s_suspend_domain,
    unsuspend_domain as k8s_unsuspend_domain,
    K8sClientError,
    K8sConflictError,
    K8sNotFoundError,
)
from . import views, views_logging

urlpatterns = [
    path("", views.kplogin, name="kplogin"),
    path("main", views.kpmain, name="kpmain"),
    path("logout", views.logout_view, name="logout_view"),
    path("add_domain", views.add_domain, name="add_domain"),
    path("save_domain/<str:domain>", views.save_domain, name="save_domain"),
    path("view_domain/<str:domain>", views.view_domain, name="view_domain"),
    path("volumesnapshots/<str:domain>", views.volumesnapshots, name="volumesnapshots"),
    path("restore_backup/<str:domain>/<str:backup_name>", views.restore_backup, name="restore_backup"),
    path("start_backup/<str:domain>", views.start_backup, name="start_backup"),
    path("settings", views.settings, name="settings"),
    path("livetraffic", views.livetraffic, name="livetraffic"),
    path("delete_domain/<str:domain>", views.delete_domain, name="delete_domain"),
    path("startstop_domain/<str:domain>/<str:action>", views.startstop_domain, name="startstop_domain"),
    path('pods-status/', views.get_pods_status, name='pods_status'),
    path('tokens/add/', views.add_api_token, name='add_api_token'),
    path('tokens/list/', views.list_api_tokens, name='list_api_tokens'),
    path('tokens/<int:token_id>/delete/', views.delete_api_token, name='delete_api_token'),  # Delete token
    # Domain-centric DNS management routes
    path('domains/<str:domain>/dns/', views.domain_dns_records, name='domain_dns_records'),
    path('domains/<str:domain>/dns/add/', views.add_domain_dns_record, name='add_domain_dns_record'),
    path('domains/<str:domain>/dns/<int:record_index>/edit/', views.edit_domain_dns_record, name='edit_domain_dns_record'),
    path('domains/<str:domain>/dns/<int:record_index>/delete/', views.delete_domain_dns_record, name='delete_domain_dns_record'),
    path("ips/manage/", views.manage_ips, name="manage_ips"),
    path("ips/add/", views.add_ip, name="add_ip"),
    path("ips/<int:ip_id>/delete/", views.delete_ip, name="delete_ip"),
    path('users/', views.list_mail_users, name='list_mail_users'),
    path('users/create/', views.create_mail_user, name='create_mail_user'),
    path('users/<int:user_id>/edit/', views.edit_mail_user, name='edit_mail_user'),
    path('users/<int:user_id>/delete/', views.delete_mail_user, name='delete_mail_user'),
    path('domain/<int:pk>/aliases/', views.alias_list,      name='alias_list'),
    path('domain/<int:pk>/aliases/add/', views.alias_add,   name='alias_add'),
    path('aliases/<int:pk>/delete/', views.alias_delete,    name='alias_delete'),
    path('mail-aliases/',views.mail_alias_list,name='mail_alias_list'),
    path('mail-aliases/add/',views.mail_alias_create,name='mail_alias_add'),
    path('mail-aliases/<int:pk>/edit/',views.mail_alias_edit,name='mail_alias_edit'),
    path('mail-aliases/<int:pk>/delete/',views.mail_alias_delete,name='mail_alias_delete'),
    path('nodes/',                  views.node_list,   name='node_list'),
    path('nodes/<str:name>/',       views.node_detail, name='node_detail'),
    path('nodes/<str:name>/drain/', views.node_drain,  name='node_drain'),
    path('nodes/<str:name>/cordon/', views.node_cordon, name='node_cordon'),
    path('nodes/<str:name>/uncordon/',views.node_uncordon, name='node_uncordon'),
    path('pods/<str:namespace>/<str:name>/logs/',views.pod_logs,name='pod_logs'),
    path('domains/<str:domain>/backup/<str:jobid>/logs/',views.backup_logs,name='backup_logs'),
    path('domains/<str:domain>/logs/', views.domain_logs, name='domain_logs'),
    path('packages/', PackageListView.as_view(), name='list_packages'),
    path('packages/add/', PackageCreateView.as_view(), name='create_package'),
    path('packages/<int:pk>/edit/', PackageUpdateView.as_view(), name='edit_package'),
    path('profiles/', UserProfileListView.as_view(), name='list_userprofiles'),
    path('profiles/add/', UserProfileCreateView.as_view(), name='create_userprofile'),
    path('profiles/<int:pk>/edit/', UserProfileUpdateView.as_view(), name='edit_userprofile'),
    path('users/add/', UserCreateView.as_view(), name='create_user_with_profile'),
    path('profiles/<int:pk>/edit-package/',UserProfilePackageUpdateView.as_view(),name='edit_userprofile_package'),
    path("download/<str:snapshot_name>/", DownloadSnapshotView.as_view(), name="download_snapshot"),
    path("download/sql/<str:dump_name>/", DownloadSqlDumpView.as_view(), name="download_sql_dump"),
    path('restore/upload/<str:domain_name>/',UploadRestoreFilesView.as_view(),name='upload_restore'),
    path('dns/record/<int:record_id>/delete/', views.delete_dns_record, name='delete_dns_record'),
    path('dns/bulk-delete/', views.bulk_delete_dns_records, name='bulk_delete_dns_records'),
    path('logs/', views_logging.system_logs, name='system_logs'),
    path('logs/errors/', views_logging.error_logs, name='error_logs'),
    path('logs/stats/', views_logging.logs_stats, name='logs_stats'),
    path('logs/<int:log_id>/', views_logging.log_detail, name='log_detail'),
    path('logs/object/<int:content_type_id>/<int:object_id>/', views_logging.object_logs, name='object_logs'),
    path("change_password/<str:domain>/<str:password_type>", views.change_password, name="change_password"),
    # GlobalWAF routes (admin only)
    path('admin/global-waf/', views.global_waf_list, name='global_waf_list'),
    path('admin/global-waf/toggle/', views.global_waf_toggle, name='global_waf_toggle'),
    path('admin/global-waf/rules/add/', views.global_waf_add_rule, name='global_waf_add_rule'),
    path('admin/global-waf/rules/<int:rule_index>/edit/', views.global_waf_edit_rule, name='global_waf_edit_rule'),
    path('admin/global-waf/rules/<int:rule_index>/delete/', views.global_waf_delete_rule, name='global_waf_delete_rule'),
    # API endpoints
    path('api/logs/', views_logging.logs_api, name='logs_api'),
]
